name: bugit-v2
type: app
base: core22
grade: devel
summary: Cool new bugit
description: |
  This snap is a fresh new UI for bugit
version: "0.2"
confinement: devmode # required for ubuntu core to collect logs

environment:
  COLORTERM: truecolor # required for proper color display
  SSH_CONNECTION: $SSH_CONNECTION # detects if bugit is run through ssh
  # Specify the following manually if you are using the pipx version
  PROD: "1" # remove this to enable debug mode
  APPORT_LAUNCHPAD_INSTANCE: production # production or qastaging
  BUGIT_APP_NAME: bugit-v2 # only used for launchpad
  # change this to the sandbox url for debug mode
  JIRA_SERVER: https://warthogs.atlassian.net

apps:
  bugit-v2:
    # The final command must have this structure for classic confinement
    # 1. Must run `bin/python3 <python file>` and NOT directly invoking the script.
    #   Otherwise system python is used and won't have the libs
    # 2. Anything after the first token must have the $SNAP var in their path
    # If there are more "apps" later, make sure their command follows this example
    command: bin/python3 $SNAP/src/bugit_v2/app.py

  command-existence:
    command: bin/python3 $SNAP/src/bugit_v2/check_command_existence.py

  oem-getlogs:
    command: usr/bin/oem-getlogs
    environment:
      PYTHONPATH: "$PYTHONPATH:$SNAP/usr/lib/python3/dist-packages"

parts:
  dump-files:
    plugin: dump
    source: src
    organize:
      "*": src/

  bugit-v2:
    plugin: uv
    source: .
    build-snaps:
      - astral-uv
    build-environment:
      - UV_NO_BINARY: "true"
    stage-packages:
      - dmidecode
      - pciutils
    after:
      - dump-files

  apport:
    plugin: nil
    stage-packages:
      - apport # provides oem-getlogs, only works on core22
